# Mapping: Anforderungen zu Implementierung (FinanceManager)

Dieses Dokument zeigt, wie die Anforderungen aus dem Anforderungskatalog im aktuellen Code umgesetzt sind. Es dient als Übersicht für den Projektstand und zur Identifikation offener Punkte.

| Nr.              | Status | Anforderung (Kurzbeschreibung)                                          | Implementierung im Code / Stand                                                                                                                                                 |
|------------------|--------|-------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| FA-KTO-001       | ✔      | Beliebig viele Bankkonten anlegen                                       | AccountService, AccountsController, UI                                                                                                                                          |
| FA-KTO-002       | ✔      | Kontotyp (Giro/Spar)                                                    | AccountService, Domain.AccountType Enum                                                                                                                                         |
| FA-KTO-003       | ✔      | Automatische Bankkontakt-Anlage                                         | AccountService, ContactService                                                                                                                                                  |
| FA-KTO-004       | ✖      | Konto teilen mit anderen Benutzern                                      | (Teilen-Logik noch offen)                                                                                                                                                       |
| FA-AUSZ-001      | ✔      | Kontoauszugdateien einlesen (CSV, PDF)                                  | StatementDraftService, FileReader                                                                                                                                                |
| FA-AUSZ-002      | ✔      | Für jeden Import wird ein Buch.-Blatt erzeugt                           | StatementDraftService, Domain.StatementDraft                                                                                                                                    |
| FA-AUSZ-003      | ✔      | Buch.-Blatt Einträge bearbeiten, ergänzen, löschen                      | StatementDraftService, UI (Detail + Editiermodus); Archivierungs-Flag für Sparpläne; manuelle Kontierung inkl. Reset bereits gebuchter Einträge (Duplikat-Reset)                                                   |
| FA-AUSZ-004      | ✔      | Beim Buchen entstehen Bankposten                                        | StatementDraftService.BookAsync → `PostingKind.Bank`                                                                                                                            |
| FA-AUSZ-005      | ✔      | Duplikatserkennung beim Import                                          | StatementDraftService: Duplikatprüfung; Duplikat-Reset/Manuelle Kontierung möglich (Reset-Endpoint + UI)                                                                                                           |
| FA-AUSZ-006      | ✔      | Kostenneutral bei eigenen Kontakten                                     | StatementDraftService: Status-/CostNeutral-Logik                                                                                                                                |
| FA-AUSZ-007      | ✔      | Kontaktposten beim Buchen entstehen                                     | StatementDraftService.BookAsync → `PostingKind.Contact`                                                                                                                         |
| FA-AUSZ-008      | ✔      | Empfänger muss Kontakt zugeordnet werden                                | StatementDraftService, UI                                                                                                                                                       |
| FA-AUSZ-009      | ~      | Wertpapierzuordnung bei eigener Bank                                    | UI & API; PDF-Detailimport (ING) erweitert; Depot-/Positionslogik offen                                                                                                         |
| FA-AUSZ-010      | ✔      | PDF-Parsing mit Tabellenextraktion                                      | ING_StatementFileReader, Barclays_StatementFileReader, erweiterbar                                                                                                              |
| FA-AUSZ-011      | ✔      | Import-Pipeline mit Format-Strategie                                    | StatementDraftService, Reader-Interface                                                                                                                                         |
| FA-AUSZ-012      | ✔      | Anzeige Gesamtbetrag verknüpfter Aufteilungs-Auszüge im Eintrag         | StatementDraftsController GetEntry; EntryDetail UI                                                                                                                              |
| FA-AUSZ-013      | ~      | Status offen bei Zahlungsintermediär bis vollständig gesplittet         | TryAutoAssignContact; fehlende Gesamtaggregation über alle verknüpften Splits offen                                                                                             |
| FA-AUSZ-014      | ✔      | Originaldatei speichern & Download / Inline-Ansicht                     | StatementDraft.OriginalFileContent; `/file` Endpoint; Viewer                                                                                                                    |
| FA-AUSZ-015      | ✔      | Massenbuchung Kontoauszüge                                              | BackgroundTask BookingTaskExecutor + Manager; `/api/statement-drafts/book-all`; Fortschritt UI                                                                                  |
| FA-AUSZ-016      | (∑)    | Konfigurierbare Monatsbasierte Aufteilung                               | Siehe Unterpunkte -01..-12 / NFA -01..-04                                                                                                                                        |
| FA-AUSZ-016-01   | ✔      | Konfigurationsbereich Setup                                             | `SetupImportSplitTab.razor`                                                                                                                                                     |
| FA-AUSZ-016-02   | ✔      | Einstellbare Werte                                                      | DTO `ImportSplitSettingsDto`, Controller, Migration                                                                                                                             |
| FA-AUSZ-016-03   | ✔      | Default-Werte neue Benutzer                                             | Defaults im `User`                                                                                                                                                              |
| FA-AUSZ-016-04   | ✔      | Berücksichtigung Benutzereinstellungen                                  | Split-Algorithmus (Monthly / Fixed / Hybrid)                                                                                                                                    |
| FA-AUSZ-016-05   | ✔      | Validierung                                                             | UI + API + Domain (`User.SetImportSplitSettings`)                                                                                                                               |
| FA-AUSZ-016-06   | ✔      | Logging                                                                 | Info-Log `CreateDraftAsync`                                                                                                                                                     |
| FA-AUSZ-016-07   | ✖      | UI-Hinweis nach Import                                                  | Offener Notification/Result DTO                                                                                                                                                 |
| FA-AUSZ-016-08   | ✔      | Fallback Defaults                                                       | Bei fehlender UserSettings                                                                                                                                                      |
| FA-AUSZ-016-09   | ✔      | Performance                                                             | Ein Pass + Sort (O(n log n))                                                                                                                                                    |
| FA-AUSZ-016-10   | ✔      | Reihenfolge Drafts / Entries                                            | Sortierung BookingDate / Subject                                                                                                                                                |
| FA-AUSZ-016-11   | ✔      | Aufteilungskontoauszüge berücksichtigt                                  | UploadId-Gruppierung                                                                                                                                                            |
| FA-AUSZ-016-12   | ✔      | Mindestanzahl Einträge Merge                                            | `ApplyMonthlyMinMerge` + Tests                                                                                                                                                  |
| FA-AUSZ-017      | ✔      | Persistenter Navigationskontext                                         | Query Parameter, Weitergabe                                                                                                                                                     |
| FA-UI-001        | ~      | Suchfeld in Listen                                                      | Kontakte + Merge; andere Listen offen                                                                                                                                           |
| FA-UI-002        | ~      | Live-Filterung                                                          | Debounce Kontakte                                                                                                                                                               |
| FA-UI-003        | ✔      | Einheitliches Menüband                                                  | `Ribbon.razor` + Seiten migriert + Basis-A11y                                                                                                                                   |
| FA-REP-006       | ✔      | Umsatz‑Auswertungsgraphen                                               | BarChart + Endpoints Accounts/Contacts/Savings/Securities + Home KPI                                                                                                           |
| FA-REP-006-01    | ✔      | Summe Beträge pro Intervall (Bar-Chart)                                 | `PostingTimeSeriesService` (Aggregates)                                                                                                                                         |
| FA-REP-006-02    | ✔      | Intervalle: Monat, Quartal, Halbjahr, Jahr                              | Alle vier Intervalle                                                                                                                                                            |
| FA-REP-006-03    | ✔      | Standardintervall Monat                                                 | Default = Month                                                                                                                                                                 |
| FA-REP-006-04    | ✔      | Leere Perioden optional (weggelassen)                                   | Nur vorhandene Perioden                                                                                                                                                          |
| FA-REP-006-05    | ✔      | Negative Werte nach unten                                               | Geteilte Chart-Hälfte                                                                                                                                                            |
| FA-REP-006-06    | ✔      | Tooltip mit Zeitraum + Betrag                                           | title + aria-label                                                                                                                                                               |
| FA-REP-006-07    | ✔      | Aggregation nach BookingDate                                            | PostingAggregates Basis                                                                                                                                                          |
| FA-REP-006-08    | ✔      | Zeitraumbegrenzung (MaxYearsBack)                                       | Query-Parameter `maxYearsBack` (Controller), Service-Filter (PeriodStart >= Grenze), UI `AggregateBarChart.MaxYearsBack`                                                         |
| FA-REP-006-09    | ✔      | Einheitlicher API-Parameter period                                      | Einheitlich `period`                                                                                                                                                              |
| FA-REP-006-10    | ✔      | Wechsel Intervall -> Reload (Spinner)                                   | Overlay + Skeleton Initial Load                                                                                                                                                  |
| NFA-REP-006-01   | ✔      | Performance (leichte DOM-Struktur)                                      | Leichte Div-Struktur                                                                                                                                                             |
| NFA-REP-006-02   | ✔      | Responsives Layout / Overflow                                           | Flex Layout (gleichmäßige Verteilung, keine Scrollbar), adaptive Label-Ausdünnung, keine Überlappung in KPI-Kacheln                                                             |
| NFA-REP-006-03   | ✔      | Lokalisierte Formate                                                    | Kulturabhängige Tooltip- und Achsen-Labels (Monate abgekürzt, Jahr nur falls nötig, Q/H mit optionalem Jahr), Tooltips lokalisiert                                               |
| NFA-REP-006-04   | ✔      | Wiederverwendbare Komponente                                            | `AggregateBarChart`                                                                                                                                                              |
| NFA-REP-006-05   | ✔      | Accessibility (ARIA Label pro Balken)                                   | aria-label je Balken                                                                                                                                                             |
| NFA-AUSZ-016-01  | ✔      | Serverseitige User-Konfiguration                                        | User-Entität erweitert                                                                                                                                                          |
| NFA-AUSZ-016-02  | ✖      | Erweiterbar für künftige Strategien                                     | Strategy/Resolver offen                                                                                                                                                         |
| NFA-AUSZ-016-03  | ✔      | Unit Tests Splitalgorithmus                                             | Alle Modi                                                                                                                                                                       |
| NFA-AUSZ-016-04  | ~      | O(n) Laufzeit bestätigt                                                 | Messung ausstehend                                                                                                                                                              |
| FA-REP-008       | ✔      | Berichtsdashboard konfigurierbare Aggregationen                         | ReportDashboard + Aggregation + Favoriten; Entitätstyp-Multi-Gruppierung, Kategorie‑Totals, Drilldown, Vergleiche, Mini‑Chart, YTD                                             |
| FA-REP-008-01    | ✔      | Auswahl Postenart                                                       | Dropdown PostingKind (ReportDashboard)                                                                                                                                          |
| FA-REP-008-02    | ✔      | Gruppierung nach Entitätstyp (Multi)                                    | Multi‑Selection UI (PostingKinds), Service aggregiert Type‑Ebene (`Type:` Knoten) inkl. Category/Entity Drilldown                                                               |
| FA-REP-008-03    | ✔      | Sekundäre Gruppierung Kategorie                                         | IncludeCategory + Category Totals + Child Rows                                                                                                                                  |
| FA-REP-008-04    | ✔      | Expandierbare Entitätszeilen                                            | Kategorie-Drilldown (Toggle, aria-expanded)                                                                                                                                     |
| FA-REP-008-05    | ✔      | Periodenwahl inkl. YTD                                                  | Interval Select (Month/Quarter/HalfYear/Year/Ytd)                                                                                                                               |
| FA-REP-008-06    | ✔      | Vergleich Vorperiode optional                                           | ComparePrevious → PreviousAmount                                                                                                                                                 |
| FA-REP-008-07    | ✔      | Vergleich Vorjahreszeitraum optional                                    | CompareYear → YearAgoAmount                                                                                                                                                     |
| FA-REP-008-08    | ✔      | Optionales Balkendiagramm                                               | Mini-Chart (ShowChart)                                                                                                                                                          |
| FA-REP-008-09    | ✔      | YTD Balkendarstellung (Vorjahre)                                        | YTD Transform + YearAgo                                                                                                                                                         |
| FA-REP-008-10    | ✔      | Bericht als Favorit speichern                                           | POST `/api/report-favorites` + Dialog                                                                                                                                           |
| FA-REP-008-11    | ✔      | Favoriten laden & anwenden                                              | GET Liste + ApplyFavorite                                                                                                                                                       |
| FA-REP-008-12    | ✔      | Favoriten umbenennen / löschen                                          | PUT / DELETE Favorites                                                                                                                                                          |
| FA-REP-008-13    | ✔      | Analysedatum monatsweise einstellbar (Referenzmonat)                    | `ReportAggregationQuery.AnalysisDate`, Controller/Service angepasst, UI Month‑Picker                                                                                            |
| FA-REP-008-14    | ✔      | Entitätswertfilter: UI (Single‑Kind Basis)                              | ReportDashboard: Multi‑Select für Top‑Level Filter (entweder Kategorie‑IDs oder Entitäts‑IDs je nach Modus); Dialog + Anwendung im Report                                      |
| FA-REP-008-15    | ✔      | Entitätswertfilter: Aggregation + API                                   | Implementiert: `ReportAggregatesController` akzeptiert Filter, `ReportAggregationQuery`/DTOs erweitert, `ReportAggregationService` filtert Top‑Level (Kategorie/Entität) vor Aggregation. Tests vorhanden. |
| FA-REP-008-16    | ✔      | Entitätswertfilter: Multi‑Kind Support                                  | Implementiert: Separate Allow‑Listen pro `PostingKind`, Kombination mit `IncludeCategory` berücksichtigt (Bank ohne Kategorien), Kantenfälle behandelt. UI Tabs/Scroll, Service aggregiert `Type:` + Kinder. Tests vorhanden. |
| FA-REP-008-17    | ✔      | Entitätswertfilter in Favoriten speichern                               | `ReportFavorite` + Service/Controller um Filter‑Felder erweitert; UI sendet `Filters` bei Save/Update; Persistenz in DB (CSV‑Felder)                                            |
| FA-REP-008-18    | ✔      | Entitätswertfilter aus Favoriten anwenden                               | `ApplyFavorite` setzt `_selectedFilterIds` anhand gespeicherter Filter; UI/Query aktualisiert                                                                                   |
| FA-REP-008-19    | ✖      | UX: Aktive‑Filter‑Badges + Schnell‑Löschen                              | Anzeige aktive Filter (Chips) oberhalb Ergebnis; Clear‑All / Einzeln entfernen; i18n + A11y                                                                                    |
| NFA-REP-008-01   | ✖      | Performance (Serveraggregation, Paging/Virtualization)                  | Kein Paging / Virtual Scroll                                                                                                                                                    |
| NFA-REP-008-02   | ✖      | Caching                                                                 | Kein Cache Layer                                                                                                                                                                |
| NFA-REP-008-03   | ✔      | Security (User-Scope Favoriten)                                         | OwnerUserId-Filter in Service/Controller                                                                                                                                        |
| NFA-REP-008-04   | ✔      | Accessibility (ARIA für Expand/Chart)                                   | aria-expanded, aria-label Chart                                                                                                                                                 |
| NFA-REP-008-05   | ~      | Internationalisierung                                                   | Beträge/Strings lokalisiert; Interval Enum-Werte roh                                                                                                                            |
| NFA-REP-008-06   | ✖      | Persistente UI-Einstellungen (letzte Auswahl)                           | Nur Favoriten, kein Autosave Filter                                                                                                                                             |
| NFA-REP-008-07   | ✖      | Export-Vorbereitung DTO                                                 | Offen                                                                                                                                                                           |
| NFA-REP-008-08   | ✖      | Performance: Filterung auf DB‑Ebene                                     | Vorfilterung in Aggregates‑Abfrage; Indizes prüfen/ergänzen; Messungen + ggf. Paging                                                                                           |
| FA-BACK-001      | ✔      | Backup erstellen                                                        | BackupService + Controller + UI                                                                                                                                                  |
| FA-BACK-002      | ✔      | Backups auflisten & herunterladen                                       | BackupService.List / OpenDownload + UI                                                                                                                                           |
| FA-BACK-003      | ✔      | Backup hochladen                                                        | Upload Endpoint + Service                                                                                                                                                        |
| FA-BACK-004      | ✔      | Backup wiederherstellen (asynchron)                                     | BackgroundTaskManager + Executor + Panel                                                                                                                                         |
| FA-BACK-005      | ✔      | Backup löschen                                                          | Delete Endpoint + Service + UI                                                                                                                                                   |
| FA-KON-001       | ✔      | Kontakte verwalten (CRUD)                                               | ContactService, ContactsController, UI                                                                                                                                           |
| FA-KON-002       | ✔      | Kontakte können Kategorie zugeordnet werden                             | ContactService, UI                                                                                                                                                               |
| FA-KON-003       | ✔      | Anwender als Kontakt angelegt                                           | Initialisierung / ContactService                                                                                                                                                 |
| FA-KON-004       | ✔      | Aliasnamen mit Wildcards pflegen                                        | Alias-Management + Matching                                                                                                                                                      |
| FA-KON-005       | ✔      | Kontakte verschmelzen (Merge)                                           | MergeAsync + Dialog + Controller                                                                                                                                                 |
| FA-AUTO-001      | ✔      | Aliasnamen für automatische Kontaktzuordnung                            | StatementDraftService Alias-Matching                                                                                                                                             |
| FA-AUTO-002      | ✔      | Duplikate werden ausgelassen                                            | Duplikatprüfung im Import                                                                                                                                                        |
| FA-SPAR-001      | ✔      | Sparpläne verwalten (CRUD)                                              | SavingsPlanService + Controller + UI                                                                                                                                             |
| FA-SPAR-002      | ✔      | Sparplan-Typen                                                          | Enum SavingsPlanType                                                                                                                                                             |
| FA-SPAR-003      | ✔      | Wiederkehrende Intervalle                                               | Implementiert: Wiederkehrende Intervalle ohne Business-Day; Monatsende-Regel (31. bleibt Monatsende, sonst Tag auf Monatsende gekappt); Domain `SavingsPlan.AdvanceTargetDateIfDue`; Aufruf im Buchungsprozess; Unit-Tests; Ressourcen (Intervall-Labels) aktualisiert. |
| FA-SPAR-004      | ✖      | Automatische Sparplanvorschläge                                         | Offen                                                                                                                                                                            |
| FA-SPAR-005      | ✖      | Manuelle Änderung Sparplanvorschlag                                     | Offen                                                                                                                                                                            |
| FA-SPAR-006      | ~      | Statusanzeige Sparziel erreicht                                         | AnalyzeAsync Grundfunktionen; Hinweise teilweise                                                                                                                                 |
| FA-SPAR-007      | ✖      | Anzeige fehlender Buchungen zum Ziel                                    | Offen                                                                                                                                                                            |
| FA-SPAR-008      | ✔      | Prognose Zielverfehlung                                                 | AnalyzeAsync (Durchschnitt vs. Soll)                                                                                                                                             |
| FA-SPAR-009      | ✔      | Archivierung bei Ausbuchung                                             | Auto-Archiv bei Saldo 0                                                                                                                                                          |
| FA-SPAR-010      | ✖      | Sparplan aus Rückzahlung/Kredit                                         | Offen                                                                                                                                                                            |
| FA-SPAR-011      | ✔      | Sparplanposten bei Buchung                                              | PostingKind.SavingsPlan                                                                                                                                                          |
| FA-SPAR-012      | ✖      | Umschalten aktive/archivierte Sparpläne                                 | Offen                                                                                                                                                                            |
| FA-WERT-001      | ✔      | Wertpapiere verwalten                                                   | SecurityService + Controller + UI                                                                                                                                                |
| FA-WERT-002      | ~      | Wertpapiertransaktionen                                                 | Teilweise (Import/Buchung); Positionslogik offen                                                                                                                                 |
| FA-WERT-003      | ✔      | Wertpapierposten bei Buchung                                            | PostingKind.Security                                                                                                                                                             |
| FA-WERT-004      | ~      | Kursabruf AlphaVantage API                                              | SecurityPriceWorker (Rate-Limit Handling)                                                                                                                                        |
| FA-WERT-005      | ~      | Historische Kurse nachholen                                             | Backfill + inkrementell                                                                                                                                                          |
| FA-WERT-006      | ✔      | API-Limit erkennen/beachten                                             | Note/Information Handling + Backoff                                                                                                                                              |
| FA-WERT-007      | ✔      | Speicherung Kursposten                                                  | SecurityPrice Entity + Unique Index                                                                                                                                              |
| FA-WERT-008      | ✖      | Renditeberechnung                                                       | Offen                                                                                                                                                                            |
| FA-WERT-009      | ✔      | Kursliste im UI (Infinite Scroll)                                       | `SecurityPrices.razor`                                                                                                                                                           |
| FA-REP-001       | ✖      | Buchungsaggregation (Monat, Quartal, Jahr)                              | Offen (wird teilweise durch FA-REP-008 abgedeckt)                                                                                                                              |
| FA-REP-002       | ✖      | Year-To-Date Berechnung                                                 | Offen (in FA-REP-008 vorgesehen)                                                                                                                                                 |
| FA-REP-003       | ✖      | Vergleich mit Vorjahr                                                   | Offen (in FA-REP-008 vorgesehen)                                                                                                                                                 |
| FA-REP-004       | ✖      | GuV pro Monat/Kategorie                                                 | Offen (Kategorie-Gruppierung in FA-REP-008 Ansatz)                                                                                                                               |
| FA-REP-005       | ✖      | Renditekennzahlen Wertpapiere                                           | Offen                                                                                                                                                                            |
| FA-REP-006       | ✔      | Umsatz‑Auswertungsgraphen für alle Entitäten mit Postings               | (Siehe Sub-Items)                                                                                                                                                               |
| FA-REP-007       | ✖      | Export von Postenlisten (CSV & Excel)                                   | Offen                                                                                                                                                                            |
| FA-KPI-001       | ✖      | Dividenden aktueller Monat                                              | Offen                                                                                                                                                                            |
| FA-KPI-002       | ✖      | Dividenden aktuelles Jahr                                               | Offen                                                                                                                                                                            |
| FA-KPI-003      | ~       | Einnahmen/Ausgaben pro Monat                                            | BarChart (All-Accounts Aggregation)                                                                                                                                              |
| FA-KPI-004       | ✖      | Gesamtdepotrendite aktuelles Jahr                                       | Offen                                                                                                                                                                            |
| FA-KPI-005       | ✖      | KPI-Fallback Jahresanfang                                               | Offen                                                                                                                                                                            |
| FA-KPI-006      | ~       | Quartalsdividenden Übersicht                                            | Endpoint `/api/securities/dividends`, KPI-Kachel                                                                                                                                 |
| FA-KPI-007       | ✔      | Favoritenberichte als Home‑KPIs (Editiermodus + Dialog + Darstellung)   | Startseite: Editiermodus mit dynamischem KPI‑Hinzufügen über Plus‑Platzhalter; Dialog bietet vordefinierte KPIs oder Berichtsfavoriten; Anzeigeoptionen: (a) nur aktiver Gesamtbetrag, (b) Gesamtbetrag + Vergleichswerte als Balken, (c) Berichtsgrafik. Klick auf KPI öffnet Bericht (Ansichtmodus). Löschen eines Favoriten löscht zugehörige KPIs. Tests stellen Lösch‑Kaskade sicher. |
| FA-ATT-001       | ✔      | Anhänge an Kontoauszugeintrag (DraftEntry) hochladen                    | Implementiert: Ein einziger Anhang ergibt sich automatisch beim Upload des Kontoauszugs. `StatementDraftService.CreateDraftHeader` lädt die Originaldatei via `IAttachmentService.UploadAsync` als `AttachmentEntityKind.StatementDraft` (kein separater Entry‑Upload). |
| FA-ATT-002       | ✔      | Anhänge nach Buchung weiterhin abrufbar                                 | Implementiert: `StatementDraftService.BookAsync`/`PropagateEntryAttachmentsAsync` nutzt `IAttachmentService.ReassignAsync` (DraftEntry→Posting, Draft→Account) und `CreateReferenceAsync` für weitere Postings (ohne Blob-Kopie). |
| FA-ATT-003       | ✔      | Anhänge an gebuchten Postings anzeigen                                  | PostingsAccount/Contact/Security: Ribbon „Anhänge“ öffnet Overlay mit `AttachmentsPanel` (`ParentKind = Posting`). StatementEntry-Ansicht entfällt.                              |
| FA-ATT-004       | ✔      | Anhänge an Kontakten verwalten                                          | `ContactDetail.razor` integriert `AttachmentsPanel` (`ParentKind = Contact`) inkl. Upload, Kategoriefilter und Download über bestehende API.                      |
| FA-ATT-005       | ✔      | Kategorien für Anhänge verwalten                                        | API List/Create/Delete/Update; UI: Setup-Tab `SetupAttachmentCategoriesTab` (Anlegen, Umbenennen, Löschen). Löschen ist für System- oder genutzte Kategorien gesperrt; Umbenennung auch bei genutzten Kategorien erlaubt. |
| FA-ATT-006       | ✔      | Kategorie beim Upload wählbar/änderbar                                  | `AttachmentsPanel`: Filter + Upload mit Kategorie + Bearbeitung Kategorie                                                                                                       |
| FA-ATT-007       | ✔      | Download eines Anhangs                                                  | `GET /api/attachments/{id}/download` (Content-Disposition: attachment) + Download-Button im `AttachmentsPanel`                                                                 |
| FA-ATT-008       | ✔      | Meta-Anzeige (Name, Größe, Typ, Upload-Datum, Kategorie)                 | `AttachmentDto` Felder vorhanden; UI‑Liste `AttachmentsPanel` zeigt Metadaten + Kategoriefilter                                                                                 |
| FA-ATT-009       | ✔      | Validierung Größe/Typ/Duplikat-Hash optional                            | Implementiert: `AttachmentUploadOptions`, `AttachmentsController`                                                                                                                |
| FA-ATT-010       | ✔      | Löschung nur durch Besitzer                                             | Ownership‑Prüfung in Service/Controller                                                                                                                                          |
| FA-ATT-011       | ✔      | Buchungsvorgang überträgt Anhänge (ohne Blob-Kopie)                     | `StatementDraftService` verschiebt/zuordnet Anhänge per `IAttachmentService.ReassignAsync` und erzeugt Referenzen (`CreateReferenceAsync`) für weitere Postings. |
| FA-ATT-012       | ✔      | API: paginierbare Listen                                                | `GET /api/attachments/{entityKind}/{entityId}?skip&take&categoryId&isUrl&q` → `PageResult<AttachmentDto>`; UI `AttachmentsPanel` mit Lazy-Load. |
| FA-ATT-013       | ✔      | UI Upload (Button, später Drag&Drop)                                    | `AttachmentsPanel`: Button-Upload und Drag&Drop (Blazor InputFile + JS Interop)                                                                                       |
| FA-ATT-014       | ✔      | Mehrfachupload (nacheinander)                                           | `AttachmentsPanel`: Mehrfachauswahl/Drop → sequenzielles Hochladen                                                                                                             |
| FA-ATT-015       | ✔      | Fortschritt / Busy-Indikator                                            | `AttachmentsPanel`: Fortschrittsanzeige (done/total) + Busy-State                                                                                                               |
| FA-NOT-001      | ✔       | Zeitgesteuerte Monatsabschluss‑Benachrichtigung (letzter Werktag)      | `BusinessDayCalculator` (Wochenende), `MonthlyReminderScheduler` + `MonthlyReminderJob` (HostedService). Nager.Date‑Feiertagskalender (Land + Counties/Subdivision) und Nutzer‑Zeitzone/Uhrzeit werden berücksichtigt; Provider wählbar (Memory/NagerDate). Texte lokalisiert. |
| FA-NOT-002      | ✔       | Konfiguration Monatsabschluss‑Hinweis                                   | User-Setting `MonthlyReminderEnabled`, Uhrzeit (Hour/Minute), Feiertags‑Provider (Memory/NagerDate), `HolidayCountryCode` + `HolidaySubdivisionCode`; API `UserNotificationSettingsController`, UI `SetupNotificationsTab`. Individueller Nachrichtentext offen. |
| FA-NOT-003      | ✔       | Darstellung Hinweis auf Startseite                                      | `HomeNotifications` Komponente, `NotificationsController` + `NotificationService` (List/Dismiss); zeigt optional Aktionslink.                                                    |
| FA-API-001       | ✔      | Web API für alle Entitäten                                              | Controller (Accounts, Contacts, Statements, Securities, etc.)                                                                                                                    |
| FA-API-002       | ~      | Suchkriterien für API                                                   | Kontakte: type + q; weitere Entitäten partiell                                                                                                                                   |
| FA-API-003       | ✔      | Authentifizierung & Autorisierung                                       | JWT + `[Authorize]`                                                                                                                                                              |
| FA-API-004      | ~      | Rate Limiting/Caching Kursabfragen                                      | Worker-seitig (AlphaVantage) – Gateway-Limit offen                                                                                                                               |
| FA-AUTH-001      | ✔      | Anmeldung erforderlich                                                  | JWT Auth Pipeline                                                                                                                                                                |
| FA-AUTH-002      | ✔      | JWT-Token bei Anmeldung                                                 | JwtBearer                                                                                                                                                                        |
| FA-AUTH-003      | ✔      | Token im Authorization Header                                           | JwtBearer                                                                                                                                                                        |
| FA-AUTH-004      | ✔      | Datenzugriff auf Benutzer gescoped                                      | Services & Controller filtern nach UserId                                                                                                                                        |
| FA-AUTH-005      | ✖      | Konto teilen mit Benutzer                                               | Offen                                                                                                                                                                            |
| FA-AUTH-006      | ✖      | Schreibrechte konfigurierbar                                            | Offen                                                                                                                                                                            |
| FA-AUTH-007      | ✖      | Entzug von Freigaben                                                    | Offen                                                                                                                                                                            |
| FA-AUTH-008      | ✔      | Passworthashing                                                         | PBKDF2 (Ziel Argon2id/bcrypt)                                                                                                                                                    |
| FA-AUTH-009      | ✔      | Admin-Oberfläche Benutzerverwaltung                                     | AdminUsersController + `Users.razor`                                                                                                                                             |
| FA-AUTH-010      | ✖      | Erster Benutzer = Admin                                                 | Offen                                                                                                                                                                            |
| FA-AUTH-011      | ✔      | Admin kann Benutzer bearbeiten/löschen                                  | Update/Delete Endpoints + UI                                                                                                                                                     |
| FA-AUTH-012      | ✖      | Löschen entfernt private Daten                                          | Offen                                                                                                                                                                            |
| FA-AUTH-013      | ✔      | Admin kann Sperren aufheben                                             | Unlock Endpoint + UI                                                                                                                                                            |
| FA-AUTH-014      | ✔      | Fehlversuche zählen am Benutzer (Reset nach 5 Min)                      | Verdrahtet: `UserAuthService` nutzt `User.RegisterFailedLogin(_clock.UtcNow, ResetWindow)` (5 Minuten). Zähler werden persistiert und bei erfolgreichem Login zurückgesetzt.    |
| FA-AUTH-015      | ✔      | Globaler Fehlversuchszähler (unbekannter Benutzer, Reset nach 5 Min)    | `IIpBlockService.RegisterUnknownUserFailureAsync` erhöht Zähler in `IpBlock` mit 5‑Minuten‑Reset‑Fenster. Persistenz via `AppDbContext.IpBlocks`.                               |
| FA-AUTH-016      | ✔      | IP‑Sperrliste ab 3 Fehlversuchen                                        | Ab 3 Fehlversuchen (bekannter oder unbekannter Benutzer) wird die IP per `IpBlock.Block(...)` gesperrt. Schwellenwert/Reset im Service.                                         |
| FA-AUTH-017      | ✔      | Middleware blockiert gesperrte IP‑Adressen                              | `IpBlockMiddleware` liefert 403 + JSON. Registrierung in `Program.cs` direkt nach `RequestLoggingMiddleware`.                                                                   |
| FA-AUTH-018      | ✔      | Admin kann Sperrliste verwalten                                         | `AdminIpBlocksController` (CRUD/Block/Unblock/Reset), Blazor‑Komponente `SetupIpBlockTab` im Setup‑Bereich (Tab „IP‑Sperrliste“), Ressourcen de/en vorhanden.                    |
| FA-AUTH-019      | ✔      | Benachrichtigung an Admins bei neuer Sperre                             | Zentral über `IpBlockService` (Unknown‑User/Block‑Eskalation) + `INotificationWriter`: erzeugt `SystemAlert`‑Benachrichtigungen. UI zeigt Aktionslink an und navigiert zu `/setup?section=ip-blocks&focus=<ip>`. |
| FA-I18N-001      | ✔      | UI-Texte in Deutsch/Englisch                                            | Ressourcen + Localizer                                                                                                                                                           |
| FA-I18N-002      | ✔      | Sprache im Profil einstellen                                            | User-Setting `PreferredLanguage` inkl. UI (`SetupProfileTab`) und API (`UserProfileSettingsController`); Anwendung zur Laufzeit via `UserPreferenceRequestCultureProvider` (Claim `pref_lang` zuerst, DB als Fallback); Register/Login senden Browserwerte; JWT enthält `pref_lang` und `tz`. |
| FA-I18N-003      | ✔      | Fallback auf Browser/Systemsprache                                      | RequestLocalizationOptions                                                                                                                                                       |
| FA-I18N-004      | ✔      | Texte über Resource-Dateien verwaltet                                   | Resx-Konzept                                                                                                                                                                     |
| FA-I18N-005      | ✖      | Sprachwechsel ohne Neuanmeldung                                         | Offen                                                                                                                                                                            |
| FA-I18N-006      | ✔      | Datums-/Zahlen-/Währungsformate                                         | CultureInfo-Konfiguration                                                                                                                                                        |
| NFA-PERF-001     | ~      | Import Performance                                                      | Noch nicht validiert                                                                                                                                                             |
| NFA-PERF-002     | ~      | KPI Performance                                                         | Noch nicht validiert                                                                                                                                                             |
| NFA-SEC-001      | ✔      | Endpunkte geschützt                                                     | `[Authorize]` + JWT                                                                                                                                                              |
| NFA-SEC-002      | ✔      | Idempotenz bei Verbuchung                                               | Duplikatprüfung beim Import/Buchen                                                                                                                                               |
| NFA-SEC-003      | ✔      | Access Scope Enforcement                                                | UserId-Scoping durchgängig                                                                                                                                                       |
| NFA-SEC-004      | ✖      | Passwort-Hashing (Argon2id/bcrypt)                                      | Ziel noch offen (aktuell PBKDF2)                                                                                                                                                 |
| NFA-SEC-005      | ✖      | Token-Lebensdauer/Refresh-Token                                         | Offen                                                                                                                                                                            |
| NFA-SEC-006      | ✖      | Audit Logging sicherheitsrelevanter Aktionen                            | Offen                                                                                                                                                                            |
| NFA-SEC-007      | ✖      | Login-Sperre nach Fehlversuchen                                         | Offen                                                                                                                                                                            |
| NFA-SEC-008      | ✖      | Admin-Audit Logging                                                     | Offen                                                                                                                                                                            |
| NFA-REL-001      | ✔      | Fehler beim Kursabruf blockiert Hauptfunktionen nicht                   | Fehlerhandling Worker                                                                                                                                                            |
| NFA-REL-002      | ✔      | Langläufer im Hintergrund mit Fortschritt (Restore)                     | BackgroundTaskManager + Executor + Panel                                                                                                                                         |
| NFA-REL-003      | ✔      | Einheitliche Background-Task Queue                                      | TaskRunner + Executors + UI Panel                                                                                                                                                |
| NFA-USAB-001     | ~      | Responsive UI                                                           | Teilweise optimiert                                                                                                                                                              |
| NFA-USAB-002     | ✔      | Einheitliche Aktions‑Symbole via Sprite                                 | `wwwroot/icons/sprite.svg` (+ neues `attachment` Symbol)                                                                                                                         |
| NFA-USAB-003     | ✖      | Bestätigungsdialoge kritische Aktionen + globale Abschalt-Option        | Konzept offen                                                                                                                                                                    |
| NFA-ARCH-001     | ✔      | Trennung Domäne/Präsentation                                            | Layered Architecture                                                                                                                                                             |
| NFA-LOG-001      | ✔      | Zentrales Logging                                                       | Serilog Pipeline                                                                                                                                                                |
| NFA-I18N-001     | ✔      | Zwei Sprachen, Fallback                                                 | de/en + Fallback                                                                                                                                                                 |
| NFA-DATA-001     | ✖      | Zeitreihen effizient gespeichert                                        | Optimierte Speicherung/Aggregationen offen                                                                                                                                       |
| NFA-PRIV-001     | ✔      | Lokale Speicherung, keine Weitergabe                                    | Keine externe Weitergabe                                                                                                                                                         |
| NFA-ATT-001      | ✔      | Max. Dateigröße (Default 10 MB)                                         | Implementiert: `AttachmentUploadOptions.MaxSizeBytes` (Default 10 MB) + Prüfung im `AttachmentsController`                                                                      |
| NFA-ATT-002      | ✔      | MIME-Typ-Whitelist                                                      | Implementiert: `AttachmentUploadOptions.AllowedMimeTypes` + Prüfung im `AttachmentsController`                                                                                   |
| NFA-ATT-003      | ✔      | Speicherung zunächst in DB (BLOB)                                       | BLOB in `Attachments.Content` umgesetzt                                                                                                                                          |
| NFA-ATT-004      | ✔      | SHA-256 Hash für Duplikatprüfung                                        | Hash-Berechnung beim Upload (`AttachmentService`); (Index vorhanden oder geplant je nach Migration)                                                                              |
| NFA-ATT-005      | ✔      | Zugriffsschutz (Ownership)                                              | OwnerUserId-Prüfung/Filterung in Service/Controller konsequent                                                                                                                  |
| NFA-ATT-006      | ✔      | Lokalisierte Fehlermeldungen                                            |  UI mappt Serverfehler auf lokalisierte Texte (de/en) im `AttachmentsPanel`;                                                                                                     |
| NFA-ATT-007      | ✖      | Virenscan-Hook (Platzhalter)                                            | Geplant: Hook/Interface, Implementierung später                                                                                                                                  |
| NFA-NOT-001     | ✖       | Eventgetriebene Benachrichtigungen                                      | Optional (später): Hinweise bei Events (Fristen, System, Benutzeraktionen); Schnittstelle/Bus vorbereiten.                                                                      |
| NFA-NOT-002     | ✖       | Modulare Benachrichtigungsarchitektur                                   | Optional (später): Erweiterbare Architektur/Registry für neue Benachrichtigungstypen und Targets.                                                                               |

**Legende:**  
✔ = umgesetzt / vorhanden  
✖ = offen / noch nicht implementiert  
~ = teilweise umgesetzt / in Arbeit  
(∑) = Sammelanforderung (Gesamtstatus aus Unterpunkten)

Änderungen (03.10.2025) – Ergänzung 41:
- FA‑SPAR‑003 umgesetzt: Wiederkehrende Intervalle inkl. Monatsende‑Regel (31. bleibt Monatsende, sonst Tag gekappt). Domain `SavingsPlan.AdvanceTargetDateIfDue`, Aufruf im Buchungsprozess, Unit‑Tests ergänzt, Ressourcen (Intervall‑Labels) aktualisiert.
- Teilbuchung Fix: Einzelne Entry‑Buchung committet den Draft nicht mehr automatisch; Draft wird erst bei letzten verbleibenden Einträgen committed. Anhänge‑Reassign bleibt beim Vollcommit erhalten.

Änderungen (03.10.2025) – Ergänzung 40:
- FA‑ATT‑003 umgesetzt: Postings‑Seiten (Account/Contact/Security) mit Ribbon‑Aktion „Anhänge“ → Overlay `AttachmentsPanel` (`ParentKind = Posting`). StatementEntry‑Ansicht entfällt.
- FA‑ATT‑004 abgeschlossen: `ContactDetail` integriert Attachment‑Overlay (`ParentKind = Contact`) inkl. Upload, Kategoriefilter und Download.
- FA‑ATT‑001 abgeschlossen: Einziger Anhang pro Kontoauszug wird beim Upload gespeichert (Draft‑Ebene).
- Ressourcen de/en ergänzt für Postings‑Seiten und ContactDetail (Attachments‑Titel/Buttons).

Änderungen (02.10.2025) – Ergänzung 39:
- Paging-Envelope für Anhänge: `PageResult<T>` eingeführt; `GET /api/attachments/{entityKind}/{entityId}` liefert `Items/HasMore/Total`.
- UI `AttachmentsPanel` auf Envelope umgestellt (Infinite Scroll mit `HasMore`).
- Unit Tests angepasst (`AttachmentsControllerTests`).
- Status aktualisiert: FA‑ATT‑012 auf ✔; FA‑ATT‑010 auf ✔.

Änderungen (02.10.2025) – Ergänzung 38:
- Anhänge‑Cleanup bei Löschung: Löschen von Konten entfernt deren Anhänge; wird dadurch der letzte zugehörige Bankkontakt gelöscht, werden auch dessen Anhänge entfernt. Löschen von Kontakten löscht deren Anhänge. Löschen archivierter Sparpläne/Wertpapiere löscht die zugehörigen Anhänge. Abgedeckt in AccountService/ContactService/SavingsPlanService/SecurityService.
- Anhänge im Buchungsprozess: Reassign/Referenzierung umgesetzt. FA‑ATT‑002 und FA‑ATT‑011 auf ✔ gesetzt.

Änderungen (02.10.2025) – Ergänzung 37:
- Validierung Anhänge: Größenlimit + MIME-Whitelist serverseitig umgesetzt (`AttachmentUploadOptions`, `AttachmentsController`).
- UI: Fehlermeldungen im `AttachmentsPanel` lokalisiert (Mapping Server-Errors → de/en).
- Status aktualisiert: FA‑ATT‑009 auf ✔; NFA‑ATT‑001/002 auf ✔; NFA‑ATT‑006 auf ~.

Änderungen (02.10.2025) – Ergänzung 36:
- Anhangkategorien: Umbenennen nun unterstützt (UI Inline‑Rename in `SetupAttachmentCategoriesTab`, API `PUT /api/attachments/categories/{id}`).
- Löschen gesperrt für System‑ oder genutzte Kategorien; Umbenennung auch bei genutzten Kategorien möglich.
- Lokalisierung ergänzt: `Th_Name` in Ressourcen de/en.
- Status aktualisiert: FA‑ATT‑005 auf ✔.

Änderungen (01.10.2025) – Ergänzung 35:
- Anhänge-Panel verbessert: Drag&Drop stabilisiert (idempotente Registrierung per WeakMap), doppelte Uploads verhindert (unregister vor Re-Init, Dispose integriert).
- Kategorie-Neuanlage direkt im Panel: Plus-Button öffnet Prompt, erstellt Kategorie via API, lädt Liste neu und selektiert sie. Resx-Texte de/en ergänzt.
- API Fix: `POST /api/attachments/categories` nutzt `Created("/api/attachments/categories", dto)` statt `CreatedAtAction` (Routing-Fehler behoben).
- Status aktualisiert: FA‑ATT‑006, FA‑ATT‑013..015 auf ✔; FA‑ATT‑005 auf ~; NFA‑ATT‑003/004/005 auf ✔.

Änderungen (01.10.2025) – Ergänzung 34:
- Neues Attachment‑Overlay auf Kontodetailseite: Ribbon‑Aktion „Anhänge“ öffnet Overlay mit Liste und Kategoriefilter. Umsetzung über wiederverwendbare Komponente `AttachmentsPanel` (Blazor).
- Download‑Button in `AttachmentsPanel` nutzt `/api/attachments/{id}/download`.
- Sprite um Symbol `attachment` ergänzt; Ressourcen de/en für `AccountDetail` und `AttachmentsPanel` hinzugefügt.
- Status aktualisiert: FA‑ATT‑007 auf ✔, FA‑ATT‑008 auf ✔. Andere FA‑ATT bleiben offen (Upload, Reassign, Kontakte, Paging etc.).

Änderungen (01.10.2025) – Ergänzung 33:
- Neue Sammelanforderung „Allgemeines Datei‑Anhangssystem“ aufgenommen. Phase 1 (Kontoauszugeinträge → Postings) und Phase 2 (Kontakte + Kategorien) geplant. Alle FA‑ATT/NFA‑ATT aktuell ✖ (noch nicht implementiert). Branch-Vorschlag: `feature/attachments-phase1`.

Änderungen (01.10.2025) – Ergänzung 32:
- Manuelle Kontierung wieder ermöglicht: Duplikat‑Reset für bereits als „bereits gebucht“ markierte Einträge. UI-Hinweis/Buttons lokalisiert (de/en). Nach Reset ist der Eintrag wieder editierbar (Read‑Only wird aufgehoben).


(Frühere Änderungsnotizen siehe vorherige Versionen.)